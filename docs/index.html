<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>AURA BIM â€“ IFC Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Monaco editor CSS (still needed even if hidden) -->
    <link
      rel="stylesheet"
      data-name="vs/editor/editor.main"
      href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/editor/editor.main.min.css"
    />

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        width: 100%;
        background: #111827; /* dark slate */
        color: #e5e7eb; /* light gray text */
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        overflow: hidden;
      }

      body {
        display: flex;
        flex-direction: column;
      }

      /* Top toolbar */
      .toolbar {
        flex: 0 0 auto;
        padding: 8px 12px;
        background: #020617; /* almost black */
        border-bottom: 1px solid #1f2937;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
        font-size: 14px;
        box-sizing: border-box;
      }

      .toolbar label,
      .toolbar span {
        font-size: 14px;
      }

      .toolbar select,
      .toolbar input[type="file"],
      .toolbar input[type="button"] {
        font-size: 14px;
        background: #111827;
        border: 1px solid #374151;
        color: #e5e7eb;
        padding: 4px 8px;
        border-radius: 4px;
      }

      .toolbar input[type="button"] {
        cursor: pointer;
      }

      .toolbar input[type="button"]:hover {
        background: #1f2937;
      }

      /* Main viewer area */
      .viewer-wrapper {
        flex: 1 1 auto;
        min-height: 0;
        min-width: 0;
        position: relative;
        background: #020617;
        display: flex;
      }

      #3dcontainer {
        flex: 1 1 auto;
        width: 100%;
        height: 100%;
        position: relative;
      }

      #3dcontainer canvas {
        width: 100% !important;
        height: 100% !important;
        display: block;
      }

      /* Hidden Monaco editor container (we don't show it) */
      #container {
        display: none;
      }

      /* Properties panel */
      .properties-panel {
        position: absolute;
        top: 16px;
        right: 16px;
        width: 320px;
        max-height: 60%;
        background: rgba(15, 23, 42, 0.98); /* slate-900 almost opaque */
        border: 1px solid #1f2937;
        border-radius: 8px;
        padding: 8px 10px;
        box-sizing: border-box;
        overflow: auto;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.6);
        font-size: 12px;
      }

      .properties-panel h3 {
        margin: 0 0 6px 0;
        font-size: 13px;
        font-weight: 600;
      }

      .properties-panel table {
        width: 100%;
        border-collapse: collapse;
      }

      .properties-panel td {
        padding: 2px 4px;
        border-bottom: 1px solid #111827;
        vertical-align: top;
        word-break: break-word;
      }

      .properties-panel td.key {
        color: #9ca3af;
        font-weight: 500;
        width: 35%;
      }

      .properties-panel td.value {
        color: #e5e7eb;
      }
    </style>
  </head>

  <body>
    <!-- Hidden Monaco editor container (required for InitMonaco/InitWebIfcViewer) -->
    <div id="container"></div>

    <!-- AURA BIM Toolbar -->
    <div class="toolbar">
      <input type="button" id="runcode" value="Run Code" />
      <input type="file" id="finput" />
      <input type="button" id="cmem" value="Clear Memory" />
      <input type="button" id="rcode" value="Reset Editor" />
      <span>Log Level:</span>
      <select id="logLevel">
        <option value="6">Off</option>
        <option value="4" selected>Error</option>
        <option value="1">Debug</option>
        <option value="3">Warn</option>
      </select>
    </div>

    <!-- 3D viewer + properties panel -->
    <div class="viewer-wrapper">
      <div id="3dcontainer"></div>

      <div
        id="properties-panel"
        class="properties-panel"
        style="display: none;"
      >
        <h3>Selected element</h3>
        <div id="properties-content">Click an element in the model.</div>
      </div>
    </div>

    <!-- Monaco loader -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/loader.min.js"></script>

    <!-- Bundled viewer logic -->
    <script src="web-ifc-viewer.js"></script>

    <script>
      // Configure Monaco loader (provided by loader.min.js).
      require.config({
        paths: {
          vs: "https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs",
        },
      });

      window.MonacoEnvironment = { getWorkerUrl: () => proxy };
      let proxy = URL.createObjectURL(
        new Blob(
          [
            `
        self.MonacoEnvironment = {
            baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min'
        };
        importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.20.0/min/vs/base/worker/workerMain.min.js');
    `,
          ],
          { type: "text/javascript" }
        )
      );

      require(["vs/editor/editor.main"], function () {
        InitMonaco(monaco);
        let editor = monaco.editor.create(document.getElementById("container"), {
          value: ``,
          language: "typescript",
          theme: "vs-dark",
        });
        InitWebIfcViewer(editor);
      });
    </script>
  </body>
</html>
